# 教师界面设计方案

**日期**: 2026-01-30  
**状态**: 已确认，准备实现

## 设计概述

设计教师登录后的界面，包括侧边栏、班级概况页面和学生详情页面，支持视频上传、分析报告生成、雷达图展示等功能。

## 整体架构

### 布局结构

1. **左侧固定区域**（桌面端，48px宽）
   - 功能按钮（汉堡菜单图标）
   - 始终可见，用于切换侧边栏

2. **侧边栏**（256px宽，可滑动）
   - 顶部："班级概况"选项（默认选中）
   - 中间：学生列表（可滚动）
   - 点击学生：切换到该学生的详情页面

3. **主内容区**（占据剩余空间）
   - 默认显示：班级概况页面
   - 选择学生后：显示学生详情页面

4. **右上角固定区域**
   - 显示"教师（用户名）" + 退出按钮

## 侧边栏详细结构

### 顶部区域
- "班级概况"按钮（默认选中，高亮显示）
- 点击后显示班级概况页面

### 中间区域（可滚动）
- 标题："学生列表"
- 学生列表：
  - 每个学生显示为一行
  - 显示学生姓名（可能还有头像或学号）
  - 点击学生：切换到该学生的详情页面
  - 当前选中的学生：高亮显示
- 空状态：如果没有学生，显示"暂无学生"

### 视觉样式
- 与现有侧边栏风格一致（灰色背景、圆角、间距）
- "班级概况"和学生列表项使用相同的样式
- 选中状态：蓝色背景或边框高亮

## 班级概况页面

### 顶部统计卡片区域（3个卡片）

1. **卡片1：总学生数**
   - 显示班级中的学生总数
   - 图标 + 数字 + 标签

2. **卡片2：班级摘要**
   - AI 生成的班级摘要
   - 内容包括：班级最近表现、进步学生、需要关注的学生等
   - 定期更新（每天或每周）

3. **卡片3：待处理任务**
   - 待分析的视频数量（`videos.status = 'pending'`）
   - 待生成的报告数量（季度总结等）
   - 显示总数

### 学生列表区域
- 标题："学生列表"
- 列表项：每个学生一个卡片
  - 学生姓名
  - 学号（可选）
  - 最近活动时间或状态
  - 点击卡片：跳转到该学生的详情页面
- 空状态：如果没有学生，显示提示文字

### 布局特点
- 垂直滚动布局
- 统计卡片和学生列表之间有适当间距
- 内容居中显示，最大宽度限制
- 简约的卡片设计，避免冗余信息

## 学生详情页面结构

### 卡片式布局（可折叠）

1. **顶部信息卡片**（固定，不可折叠）
   - 学生姓名、学号
   - 最近活动时间
   - 快速操作按钮（上传视频、生成报告）

2. **能力雷达图卡片**（可折叠）
   - 标题："能力评估"
   - 内容：6 维度雷达图
     - 语言应用能力（Language Application）
     - 沟通协作能力（Communication & Collaboration）
     - 问题解决能力（Problem Solving）
     - 主动探索能力（Proactive Exploration）
     - 创造性表达（Creative Expression）
     - 学习内驱力（Intrinsic Motivation）
   - 显示：当前分数 + 历史趋势（可选）
   - 折叠后：显示总分或关键指标

3. **视频上传与分析卡片**（可折叠）
   - 标题："视频分析"
   - 内容：
     - 上传视频区域（拖拽或点击上传）
     - 已上传视频列表（缩略图 + 分析状态）
     - 点击视频：查看分析结果
   - 折叠后：显示待分析数量

4. **分析报告卡片**（可折叠）
   - 标题："学习报告"
   - 内容：
     - 报告列表（按时间排序）
     - 报告类型：单次分析报告、季度总结报告等
     - 生成报告按钮
   - 折叠后：显示最新报告日期

5. **错误纠正卡片**（可折叠）
   - 标题："需要纠正的问题"
   - 内容：
     - 语法错误列表
     - 发音错误列表
     - 每个错误：错误内容 + 正确示例 + 出现频率
   - 折叠后：显示错误总数

### 布局特点
- 卡片垂直排列，间距适中
- 默认展开第一个卡片（能力雷达图）
- 其他卡片默认折叠，点击标题展开/折叠
- 简约设计，避免信息过载

## 雷达图设计

### 6 个维度（0-100 分）

1. **语言应用能力（Language Application）**
   - 流利度（语流长度、停顿率）
   - 词汇丰富度（高级词汇使用频率）
   - 实际沟通效果

2. **沟通协作能力（Communication & Collaboration）**
   - 主动沟通（主动提问、表达想法）
   - 团队协作（鼓励他人、分工配合）
   - 倾听理解（理解他人需求、回应）

3. **问题解决能力（Problem Solving）**
   - 分析思考（识别问题、分析原因）
   - 创新方案（提出解决方案）
   - 执行能力（动手实践、完成任务）

4. **主动探索能力（Proactive Exploration）**
   - 好奇心（对主题的兴趣度）
   - 主动学习（主动探索、提问）
   - 持续参与（参与度和投入度）

5. **创造性表达（Creative Expression）**
   - 创意输出（用英语描述创意）
   - 成果展示（Vlog、食谱、报告等）
   - 想象力（在场景中的创新表现）

6. **学习内驱力（Intrinsic Motivation）**
   - 自主性（不需要外部激励的主动行为）
   - 坚持性（面对困难时的持续努力）
   - 成就感（从完成任务中获得的满足感）

### 技术实现
- 使用 `recharts` 库绘制雷达图
- 数据存储在 Supabase `student_radar_data` 表
- 前端实时渲染，不需要存储图表文件

## 数据流与状态管理

### 数据获取流程
- 教师登录后，从 Supabase 获取：
  - 班级信息（教师关联的班级）
  - 学生列表（该班级下的所有学生）
  - 学生数据（选中学生后获取：雷达图数据、视频列表、报告列表、错误列表）
- 使用 React Context 或状态管理库管理全局状态

### 状态管理结构
- `currentView`: 'overview' | 'student-detail'
- `selectedStudent`: Student | null
- `students`: Student[]
- `classStats`: ClassStats（班级统计数据）
- `loadingStates`: 各模块的加载状态

### 实时更新机制
- 视频上传后：自动刷新视频列表
- 分析完成后：更新雷达图数据、错误列表
- 报告生成后：更新报告列表
- 使用轮询或 WebSocket（如需要）获取最新状态

### 缓存策略
- 班级概况数据：缓存 5 分钟
- 学生详情数据：选中学生时获取，切换学生时更新
- 视频和分析数据：按需加载，避免一次性加载过多

## API 路由设计

### 需要创建的 API 路由

1. **`/api/classes`** - 班级管理
   - `GET`: 获取当前教师的班级信息
   - `POST`: 创建班级（教师注册后自动创建）
   - `PUT`: 更新班级信息

2. **`/api/students`** - 学生管理
   - `GET`: 获取班级下的所有学生列表
   - `POST`: 添加新学生
   - `PUT`: 更新学生信息
   - `DELETE`: 删除学生

3. **`/api/class/overview`** - 班级概况数据
   - `GET`: 获取班级概况数据
     - 总学生数
     - 最新班级摘要（从 `class_summaries` 表）
     - 待处理任务数（`videos.status = 'pending'` + 待生成的报告）
     - 学生列表（简要信息）

4. **`/api/students/[id]`** - 学生详情数据
   - `GET`: 获取学生详细信息
     - 基本信息
     - 最新雷达图数据
     - 视频列表
     - 分析报告列表
     - 错误记录列表

5. **`/api/videos`** - 视频管理
   - `POST`: 上传视频（先上传到 Blob，再保存元数据到数据库）
   - `GET`: 获取学生的视频列表
   - `DELETE`: 删除视频（同时删除 Blob 文件和数据库记录）

6. **`/api/videos/[id]/analyze`** - 视频分析
   - `POST`: 触发视频分析任务
   - `GET`: 获取分析状态和结果

7. **`/api/reports`** - 报告管理
   - `POST`: 生成分析报告（单次/季度）
   - `GET`: 获取报告列表
   - `GET /api/reports/[id]`: 获取报告详情

8. **`/api/radar/[studentId]`** - 雷达图数据
   - `GET`: 获取学生的雷达图数据（最新或历史）

### API 设计原则
- 所有 API 都需要验证教师身份
- 使用 Service Role Key 绕过 RLS 进行数据操作
- 返回统一的 JSON 格式：`{ success: boolean, data?: any, message?: string }`
- 错误处理：返回详细的错误信息

## 组件架构

### 新增组件结构

1. **教师界面主组件**
   - `app/components/teacher/TeacherDashboard.tsx` - 教师界面主容器
     - 管理侧边栏和主内容区的状态
     - 处理学生选择逻辑

2. **侧边栏组件**
   - `app/components/teacher/TeacherSidebar.tsx` - 教师侧边栏
     - 显示"班级概况"和学生列表
     - 处理导航逻辑

3. **班级概况组件**
   - `app/components/teacher/ClassOverview.tsx` - 班级概况页面
   - `app/components/teacher/OverviewStats.tsx` - 统计卡片组件
   - `app/components/teacher/StudentList.tsx` - 学生列表组件（班级概况页）

4. **学生详情组件**
   - `app/components/teacher/StudentDetail.tsx` - 学生详情页面容器
   - `app/components/teacher/StudentInfo.tsx` - 学生信息卡片
   - `app/components/teacher/RadarChart.tsx` - 雷达图组件
   - `app/components/teacher/VideoUpload.tsx` - 视频上传卡片
   - `app/components/teacher/VideoList.tsx` - 视频列表组件
   - `app/components/teacher/ReportList.tsx` - 报告列表组件
   - `app/components/teacher/ErrorList.tsx` - 错误列表组件

5. **共享组件**
   - `app/components/teacher/CollapsibleCard.tsx` - 可折叠卡片组件（复用）

### 文件结构
```
app/
├── components/
│   └── teacher/
│       ├── TeacherDashboard.tsx
│       ├── TeacherSidebar.tsx
│       ├── ClassOverview.tsx
│       ├── OverviewStats.tsx
│       ├── StudentList.tsx
│       ├── StudentDetail.tsx
│       ├── StudentInfo.tsx
│       ├── RadarChart.tsx
│       ├── VideoUpload.tsx
│       ├── VideoList.tsx
│       ├── ReportList.tsx
│       ├── ErrorList.tsx
│       └── CollapsibleCard.tsx
└── api/
    ├── classes/
    ├── students/
    ├── class/
    │   └── overview/
    ├── videos/
    ├── reports/
    └── radar/
```

## 响应式设计

### 桌面端（≥1024px）
- 侧边栏：固定左侧，打开时主内容区右移
- 主内容区：最大宽度限制（如 `max-w-6xl`），内容居中
- 统计卡片：横向排列（3-4 个）
- 学生列表：网格布局（每行 2-3 个卡片）

### 移动端（<1024px）
- 侧边栏：覆盖层模式，带半透明遮罩
- 主内容区：全宽显示，适当内边距
- 统计卡片：垂直排列
- 学生列表：单列布局

### 交互细节
- 卡片折叠/展开：平滑动画（`transition-all duration-300`）
- 加载状态：骨架屏或加载指示器
- 空状态：友好的提示文字和图标
- 错误状态：清晰的错误提示和重试按钮

### 视觉设计
- 保持与现有界面风格一致（Gemini 风格）
- 使用 Tailwind CSS 4 的深色模式支持
- 卡片使用圆角、阴影、hover 效果
- 颜色：蓝色主题（与现有登录按钮一致）

## 错误处理与边界情况

### 错误处理策略

1. **数据加载错误**
   - API 调用失败：显示错误提示和重试按钮
   - 数据为空：显示友好的空状态（如"暂无学生"）
   - 网络超时：显示超时提示，提供重试选项

2. **用户操作错误**
   - 视频上传失败：显示错误信息，保留已填写信息
   - 文件格式不支持：上传前验证，显示格式要求
   - 文件过大：上传前检查大小，显示限制提示

3. **权限错误**
   - 未登录：重定向到登录页面
   - 权限不足：显示权限提示
   - RLS 策略错误：记录日志，显示通用错误信息

4. **边界情况处理**
   - 学生数量为 0：班级概况页显示空状态和添加学生引导
   - 视频分析中：显示进度状态，禁用重复提交
   - 报告生成中：显示生成中状态，防止重复生成

### 错误提示设计
- 使用统一的错误提示组件
- 错误信息清晰、可操作
- 提供重试或返回选项

## 实现优先级

### 阶段 1：基础框架（核心功能）
1. 创建教师界面主组件和路由逻辑
2. 实现侧边栏组件（班级概况 + 学生列表）
3. 实现班级概况页面（统计卡片 + 学生列表）
4. 创建基础 API 路由（班级、学生数据获取）

### 阶段 2：学生详情页（核心功能）
5. 实现学生详情页面框架
6. 实现雷达图组件（安装 recharts，展示数据）
7. 实现视频上传功能（Blob 集成）
8. 实现视频列表展示

### 阶段 3：分析功能（重要功能）
9. 实现视频分析 API（调用 Gemini 分析视频）
10. 实现分析报告生成功能
11. 实现错误记录展示

### 阶段 4：优化与完善（增强功能）
12. 实现班级摘要生成（AI 生成）
13. 优化 UI/UX 细节
14. 添加加载状态和错误处理
15. 响应式优化

### 技术依赖
- 需要安装：`recharts`（雷达图）
- 需要配置：Blob（已完成）、Supabase（已完成）

## 数据库设计

### 数据表结构

已创建以下数据表（详见 `docs/DATABASE_DESIGN.md`）：

1. **classes** - 班级表
2. **students** - 学生表
3. **videos** - 视频表（存储 Blob URL）
4. **analysis_reports** - 分析报告表
5. **student_errors** - 学生错误记录表
6. **student_radar_data** - 雷达图数据表
7. **class_summaries** - 班级摘要表

### 数据存储策略

- **结构化数据**：存储在 Supabase PostgreSQL
- **非结构化数据**：存储在 Vercel Blob（视频文件、图片）
- **关联方式**：数据库表存储 Blob URL，通过 URL 关联

## 技术实现要点

### 前端技术
- React 19 + TypeScript
- Tailwind CSS 4
- recharts（雷达图）
- React Hooks 管理状态

### 后端技术
- Next.js API Routes（Serverless Functions）
- Supabase（数据库）
- Vercel Blob（文件存储）
- Gemini API（视频分析）

### 安全策略
- Row Level Security (RLS) 确保数据隔离
- 教师只能访问自己班级的数据
- 使用 Service Role Key 进行服务端操作

## 下一步

1. 安装依赖：`npm install recharts`
2. 创建教师界面组件
3. 实现 API 路由
4. 集成 Blob 文件上传
5. 实现雷达图展示
6. 测试和优化

---

**文档版本**: 1.0  
**最后更新**: 2026-01-30
